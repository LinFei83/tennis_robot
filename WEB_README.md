# 网球机器人Web控制系统

这是一个轻量级的网页控制系统，专为在树莓派上运行的网球机器人设计。

## 功能特性

### 1. 机器人控制
- **键盘控制**: 使用WASD键控制机器人移动，空格键停止
- **实时速度显示**: 显示当前线速度和角速度
- **位置信息**: 显示机器人当前位置（里程计数据）

### 2. 视觉系统
- **实时视频流**: 显示摄像头画面
- **网球检测**: 实时检测网球并显示检测框
- **性能监控**: 显示FPS、检测耗时等信息

### 3. 系统监控
- **CPU使用率**: 实时显示系统CPU占用情况
- **内存使用率**: 显示内存使用情况
- **电池电压**: 监控机器人电池电压状态

## 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

## 运行服务器

```bash
# 在项目根目录下运行
python web_server.py
```

服务器将在 `http://0.0.0.0:5000` 启动，可以通过局域网中的任何设备访问。

## 使用说明

### 启动步骤

1. **启动Web服务器**
   ```bash
   python web_server.py
   ```

2. **打开浏览器**
   - 在同一局域网的设备上打开浏览器
   - 访问 `http://树莓派IP:5000`

3. **启动系统组件**
   - 点击"启动机器人"按钮启动机器人控制系统
   - 点击"启动视觉"按钮启动摄像头和网球检测

### 键盘控制

确保机器人已启动后，可以使用以下按键控制：

- **W**: 前进
- **S**: 后退  
- **A**: 左转
- **D**: 右转
- **空格**: 停止

### 界面说明

#### 控制面板（左侧）
- 系统控制按钮
- 键盘控制说明
- 当前速度显示

#### 视频面板（中间）
- 实时摄像头画面
- 网球检测结果
- 检测性能信息

#### 系统监控（右侧）
- CPU和内存使用率
- 电池电压状态
- 机器人位置信息

## 技术特性

### 轻量化设计
- 使用Flask轻量级框架
- 优化的前端资源
- 适合树莓派等低功耗设备

### 实时通信
- WebSocket实时数据传输
- 低延迟键盘控制
- 实时系统状态更新

### 响应式设计
- 支持手机、平板等移动设备
- 自适应布局
- 触摸友好的界面

## 配置说明

### 机器人配置
- 串口设备: `/dev/stm32_base`
- 波特率: `115200`
- 可在 `web_server.py` 中修改

### 视觉系统配置
- 模型路径: `vision/model/model_float32_myv8.tflite`
- 置信度阈值: `0.6`
- 可在 `web_server.py` 中修改

### 网络配置
- 默认端口: `5000`
- 监听地址: `0.0.0.0` (所有网络接口)

## 故障排除

### 常见问题

1. **无法访问网页**
   - 检查防火墙设置
   - 确认树莓派IP地址
   - 检查端口5000是否被占用

2. **机器人无法启动**
   - 检查串口设备是否存在
   - 确认串口权限设置
   - 查看终端错误信息

3. **摄像头无法启动**
   - 检查摄像头连接
   - 确认摄像头权限
   - 检查模型文件是否存在

4. **键盘控制无响应**
   - 确保机器人已启动
   - 检查浏览器是否获得焦点
   - 查看浏览器开发者工具的错误信息

### 性能优化

1. **降低CPU使用率**
   - 调整视频帧率
   - 减少检测频率
   - 优化检测阈值

2. **减少网络带宽**
   - 降低视频质量
   - 调整JPEG压缩率
   - 减少状态更新频率

## 安全注意事项

- 仅在受信任的局域网中使用
- 不要暴露到公网
- 定期更新依赖包
- 使用时注意机器人安全操作

## 开发说明

### 文件结构
```
├── web_server.py          # 主服务器程序
├── templates/
│   └── index.html         # 网页模板
├── static/
│   ├── css/
│   │   └── style.css      # 样式文件
│   └── js/
│       └── app.js         # 前端JavaScript
├── base_robot/            # 机器人控制模块
├── vision/                # 视觉检测模块
└── requirements.txt       # Python依赖
```

### 扩展功能

可以通过以下方式扩展功能：

1. 添加新的API端点
2. 扩展WebSocket事件
3. 增加前端界面元素
4. 集成更多传感器数据

## 许可证

本项目仅供学习和研究使用。
